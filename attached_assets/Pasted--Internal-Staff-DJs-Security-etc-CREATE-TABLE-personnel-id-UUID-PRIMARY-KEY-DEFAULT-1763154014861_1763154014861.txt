-- Internal Staff (DJs, Security, etc.)
CREATE TABLE "personnel" (
    "id" UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    "first_name" TEXT NOT NULL,
    "middle_name" TEXT,
    "last_name" TEXT NOT NULL,
    "email" TEXT UNIQUE NOT NULL,
    "phone" TEXT UNIQUE,
    "dob" DATE,           -- Date of Birth
    "ssn" TEXT,           -- Encrypt this in the application!
    "address1" TEXT,
    "address2" TEXT,
    "city" TEXT,
    "state" TEXT,
    "zip" TEXT,
    "personnel_type_id" UUID REFERENCES "personnel_types"("id") ON DELETE SET NULL,
    "is_active" BOOLEAN NOT NULL DEFAULT true,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
-- Add the foreign key constraint from users to personnel
ALTER TABLE "users"
ADD CONSTRAINT "fk_user_personnel"
FOREIGN KEY ("personnel_id")
REFERENCES "personnel"("id")
ON DELETE SET NULL;
-- External Contacts (Venue Managers, Customer Contacts)
CREATE TABLE "contacts" (
    "id" UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    "first_name" TEXT NOT NULL,
    "last_name" TEXT,
    "email" TEXT,
    "phone" TEXT,
    "title" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    -- Add uniqueness constraint to avoid duplicate contacts
    UNIQUE("email", "phone")
);
-- Files for Personnel (Tax forms, IDs)
CREATE TABLE "personnel_files" (
    "id" UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    "personnel_id" UUID NOT NULL REFERENCES "personnel"("id") ON DELETE CASCADE,
    "document_type_id" UUID REFERENCES "document_types"("id") ON DELETE SET NULL,
    "file_path" TEXT NOT NULL, -- e.g., "s3://bucket-name/personnel/file-uuid.pdf"
    "file_name" TEXT NOT NULL, -- "W-4_2025.pdf"
    "file_type" TEXT,          -- "application/pdf"
    "file_size_bytes" BIGINT,
    "uploaded_at" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
CREATE TABLE "venues" (
    "id" UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    "name" TEXT NOT NULL,
    "address" TEXT,
    "city" TEXT,
    "state" TEXT,
    "zip" TEXT,
    "phone" TEXT,
    "website" TEXT,
    "occupancy" INT,
    "venue_type_id" UUID REFERENCES "venue_types"("id") ON DELETE SET NULL,
    "notes" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);